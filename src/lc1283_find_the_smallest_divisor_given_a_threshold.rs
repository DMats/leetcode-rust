/// Given an array of integers `nums` and an integer `threshold`, we will choose
/// a positive integer divisor and divide all the array by it and sum the result
/// of the division. Find the **smallest** divisor such that the result
/// mentioned above is less than or equal to `threshold`.
///
/// Each result of division is rounded to the nearest integer greater than or
/// equal to that element. (For example: 7/3 = 3 and 10/2 = 5).
///
/// It is guaranteed that there will be an answer.
///
/// Constraints:
///
/// * 1 <= nums.length <= 5 * 10^4
/// * 1 <= nums[i] <= 10^6
/// * nums.length <= threshold <= 10^6
pub struct Solution;
impl Solution {
    pub fn smallest_divisor(nums: Vec<i32>, threshold: i32) -> i32 {
        let mut left = 1;
        // min_divisor won't be more than max num[i].
        // Safe to use unwrap because 1 <= nums.length
        let mut right = nums.iter().max().unwrap() - 1;
        while left <= right {
            // divide and round down (floor)
            let divisor = (left + right) / 2;
            let mut sum = 0;
            for num in nums.iter() {
                // divide and round up (ceiling)
                let quotient_rounded_up = (num + divisor - 1) / divisor;
                sum += quotient_rounded_up;
            }
            if sum > threshold {
                // Solution not found. Search the right half because divisors
                // less than this would also have a sum greater than threshold.
                left = divisor + 1;
            }
            if sum <= threshold {
                // Potential solution found! Search the left half to see if a
                // lower solution exists.
                right = divisor - 1;
            }
        }
        right + 1
    }
}

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn one_two_five_nine_thresh_six() {
        assert_eq!(5, Solution::smallest_divisor(vec![1, 2, 5, 9], 6));
    }

    #[test]
    fn two_three_five_seven_eleven_thresh_eleven() {
        assert_eq!(3, Solution::smallest_divisor(vec![2, 3, 5, 7, 11], 11));
    }

    #[test]
    fn nineteen_thresh_five() {
        assert_eq!(4, Solution::smallest_divisor(vec![19], 5));
    }

    #[test]
    fn big_numbers() {
        assert_eq!(
            495280,
            Solution::smallest_divisor(vec![962551, 933661, 905225, 923035, 990560], 10)
        );
    }

    #[test]
    fn big_numbers_large_array() {
        assert_eq!(
            137702,
            Solution::smallest_divisor(
                vec![
                    653067, 154931, 685532, 822258, 950050, 137980, 879671, 469904, 688674, 511909,
                    194222, 671958, 133158, 727153, 745642, 185973, 917089, 887477, 259235, 762210,
                    951885, 575851, 480134, 973175, 183745, 430396, 883113, 37401, 599507, 372299,
                    671730, 839395, 234087, 642279, 809521, 50491, 427640, 872154, 667654, 441248,
                    102473, 836013, 522960, 625669, 945739, 348885, 941212, 206277, 449199, 100869,
                    639857, 812367, 98577, 139425, 414725, 735863, 790785, 203734, 106138, 813203,
                    753308, 371805, 855638, 922908, 401510, 298873, 109917, 418198, 520016, 709408,
                    964112, 519239, 299976, 453096, 31859, 730401, 348271, 679834, 139062, 817408,
                    209853, 74670, 415354, 475089, 824343, 248221, 451651, 602825, 492139, 609028,
                    647208, 92691, 518421, 317902, 684823, 820194, 649947, 140747, 835768, 700358,
                    975374, 760811, 472977, 201638, 7160, 488050, 812051, 505211, 10512, 40834,
                    289536, 152365, 221464, 390757, 703514, 651743, 849702, 27272, 62008, 956308,
                    424444, 252760, 534142, 321440, 487567, 431829, 520012, 608150, 103150, 772713,
                    418008, 875150, 562081, 226035, 407445, 138296, 663866, 454753, 583760, 4783,
                    119670, 137297, 770004, 953275, 258636, 347029, 478457, 946310, 802029, 605190,
                    988105, 59777, 311890, 970018, 635552, 153052, 510629, 965038, 319740, 176903,
                    955025, 119353, 46541, 351847, 496656, 70876, 457709, 879695, 94044, 521870,
                    97026, 454586, 756601, 270320, 836381, 860111, 853990, 530481, 86869, 887560,
                    130290, 743592, 278844, 384512, 613143, 313745, 596076, 226343, 66467, 791683,
                    916012, 941022, 452372, 27608, 923701, 599719, 91725, 801724, 611806, 167507,
                    646902, 45814, 432275, 418948, 195812, 61238, 198131, 828275, 374754, 684644,
                    557440, 793825, 524323, 326003, 794663, 326281, 317817, 893375, 795607, 720874,
                    582330, 556737, 666352, 250740, 470952, 619697, 442294, 893235, 55168, 75557,
                    928212, 221970, 92274, 330569, 301199, 518128, 588029, 74383, 267381, 449706,
                    861051, 658833, 150875, 50625, 942200, 410993, 526795, 441318, 107204, 708108,
                    952431, 955488, 810810, 291274, 305995, 437130, 612897, 419255, 366211, 411302,
                    223646, 748949, 478844, 173401, 975714, 822024, 520663, 500182, 346005, 54121,
                    677969, 204295, 242818, 920091, 765298, 217086, 308127, 133618, 928468, 982527,
                    833972, 74403, 122722, 400401, 553611, 585754, 784634, 612037, 821450, 836452,
                    168347, 669539, 977964, 104487, 572610, 364204, 61849, 467966, 231401, 988968,
                    431826, 466526, 124983, 138726, 543777, 733492, 53388, 304721, 579246, 431315,
                    472266, 736595, 542245, 132658, 785010, 323090, 561445, 984136, 203030, 495519,
                    459292, 542167, 134062, 774543, 95931, 562027, 418749, 392020, 818474, 989849,
                    629662, 467309, 746405, 914481, 958574, 942588, 667479, 556085, 576899, 418277,
                    244168, 787598, 998313, 787789, 355550, 902707, 789496, 171214, 664484, 310761,
                    219794, 497853, 378864, 818915, 863132, 669848, 13707, 81332, 62807, 860901,
                    39366, 323027, 577512, 578307, 118100, 972150, 257382, 644799, 916887, 261902,
                    695638, 810695, 322750, 392580, 764514, 721085, 947656, 22802, 6597, 347234,
                    69503, 599540, 147550, 566096, 46601, 259587, 46023, 422008, 331093, 543668,
                    313970, 655610, 794682, 936660, 308904, 627782, 562798, 384509, 779849, 318491,
                    796964, 442484, 339808, 228954, 951806, 828120, 432925, 611438, 482726, 349691,
                    141047, 78672, 630410, 94851, 364089, 869574, 973243, 750369, 869570, 870487,
                    392108, 124533, 468056, 281489, 783326, 591965, 880402, 464763, 1462, 495481,
                    669048, 108703, 370786, 413032, 747315, 88059, 699501, 306458, 596579, 80187,
                    390244, 972982, 977836, 435493, 999058, 988826, 879525, 211817, 101317, 696985,
                    783427, 768717, 5321, 632569, 862914, 1228, 163709, 688381, 596079, 386738,
                    875129, 939128, 565712, 8256, 606887, 636965, 293810, 433883, 981432, 922176,
                    913953, 975975, 504638, 465601, 349621, 485048, 279662, 389345, 495733, 567059,
                    77760, 13496, 445775, 460670, 592403, 883715, 975440, 862125, 480899, 606950,
                    693296, 215942, 296860, 213313, 31673, 620438, 589116, 358445, 667664, 404950,
                    62537, 751275, 511917, 718849, 685552, 937237, 295936, 729977, 599723, 533176,
                    724418, 203780, 305107, 350197, 420603, 401457, 804799, 192121, 242141, 956622,
                    940600, 500706, 556784, 604722, 474783, 880825, 377305, 806616, 324914, 9463,
                    761080, 290984, 581897, 854924, 632745, 528450, 915866, 794545, 756338, 766470,
                    828535, 71828, 648919, 397480, 151592, 407213, 923259, 928019, 904443, 115971,
                    402708, 850905, 442971, 405365, 438193, 196111, 878431, 284067, 445337, 21550,
                    920139, 969062, 484655, 69062, 172970, 850785, 566274, 868549, 690613, 311834,
                    272497, 167756, 363291, 413317, 128249, 896282, 189615, 853386, 409155, 260064,
                    172171, 432498, 509714, 432093, 426492, 806383, 160793, 952858, 228354, 83290,
                    507159, 307796, 920106, 719177, 623739, 935339, 77101, 815054, 250250, 926971,
                    465647, 669246, 21864, 447115, 756278, 249247, 276418, 318933, 267448, 918098,
                    907447, 335345, 705959, 966717, 204189, 323044, 933464, 552884, 482309, 309748,
                    614002, 245833, 303924, 356603, 137808, 917984, 718318, 355257, 134254, 877545,
                    97879, 997934, 362619, 483579, 528587, 670308, 733371, 987105, 383748, 84817,
                    772152, 182927, 980349, 635790, 918099, 275733, 161821, 363648, 20785, 102234,
                    956095, 908423, 715980, 820227, 287414, 871198, 690235, 473766, 274384, 90374,
                    607565, 792888, 532932, 760180, 679319, 887061, 293905, 801552, 239225, 216444,
                    139088, 891414, 739093, 422305, 356839, 284617, 269106, 800593, 724829, 704812,
                    366223, 255057, 954999, 864032, 467815, 758825, 463383, 223295, 923706, 821019,
                    411150, 730139, 168138, 549998, 888622, 463303, 755457, 267631, 436484, 546073,
                    459319, 339972, 514771, 196258, 780621, 897441, 723110, 586063, 805111, 675178,
                    11692, 291237, 738566, 880736, 348371, 90511, 416463, 16111, 815394, 797271,
                    824079, 565925, 640895, 839619, 701653, 797110, 594460, 484081, 836591, 114801,
                    387920, 626619, 939262, 855703, 160484, 652753, 603784, 399930, 218048, 498001,
                    768218, 77028, 517301, 957310, 865133, 774181, 655619, 835088, 4767, 240276,
                    23776, 154931, 80708, 212755, 481862, 977855, 178410, 417573, 142671, 991892,
                    910264, 190174, 303585, 523167, 576288, 51500, 393346, 768426, 21657, 278775,
                    647990, 50520, 998414, 723653, 611321, 840905, 446041, 295333, 809405, 903543,
                    243226, 372917, 266593, 353958, 389402, 984705, 601226, 917792, 44307, 442145,
                    307812, 230234, 587529, 357474, 631796, 108537, 701020, 570239, 413105, 418002,
                    396164, 121858, 45445, 775584, 281513, 473643, 35087, 724073, 416023, 275424,
                    662427, 808423, 198950, 863386, 668313, 207679, 291368, 560758, 140277, 188701,
                    104881, 393732, 424046, 984237, 929832, 778251, 59845, 211614, 165883, 782921,
                    335221, 714586, 612964, 372180, 814185, 843360, 670872, 353967, 955950, 760905,
                    523074, 465408, 125, 406790, 955958, 514438, 942455, 668793, 901222, 213829,
                    863192, 344977, 669718, 768061, 348707, 831421, 902514, 457176, 637287, 768010,
                    114660, 980085, 173120, 467883, 200446, 654732, 386044, 760765, 591669, 380998,
                    235267, 573182, 528983, 889770, 191472, 591867, 828815, 688665, 141381, 70320,
                    797348, 488835, 244011, 877129, 772630, 664635, 248555, 248356, 653916, 566775,
                    417335, 19100, 566920, 21893, 666164, 60495, 530652, 459643, 939258, 712175,
                    922026, 141225, 48130, 630205, 346897, 411182, 775909, 802248, 420966, 925991,
                    267186, 869662, 601309, 257432, 977665, 582188, 917973, 710280, 969868, 778689,
                    574228, 573929, 984186, 592567, 392666, 608853, 855230, 201489, 546811, 510742,
                    476289, 226590, 176612, 752208, 692190, 933270, 463929, 97502, 826512, 698965,
                    706744, 7539, 372578, 632959, 614227, 113116, 631509, 709908, 847093, 89731,
                    410942, 624749, 583973, 78420, 551208, 799385, 79578, 774826, 624113, 112767,
                    362881, 829547, 587357, 418882, 867740, 202689, 875392, 811451, 589688, 957024,
                    411580, 622210, 54711, 390717, 858858, 395651, 29074, 646836, 89269, 247937,
                    325618, 869131, 744974, 602649, 301447, 717375, 21603, 434805, 9841, 629892,
                    676464, 609582, 820019, 332331, 990066, 599588, 422309, 111240, 937030, 391708,
                ],
                4239,
            )
        );
    }
}
